import{Z as I,$ as z,a9 as $,j as s,B as T,ad as C,aA as H,am as x,S as L,T as q,av as A,h as c,aE as G,p as y,z as l,v as Q,a2 as U,q as j,aF as m,aG as b,w as V,u as P,e as g,a4 as W,a6 as Z,a5 as J,Q as K,F as O,aH as X,m as Y,M as ee,aD as se}from"./chunk-CwCHHjv6.js";import"./chunk-DKaSvp06.js";import{P as re}from"./chunk-1f_LnHYk.js";import{s as p}from"./chunk-C1UfUYGV.js";import{N as ae}from"./chunk-BTwWfkcn.js";import{F as oe}from"./chunk-CWpVnYI2.js";import{i as te}from"./chunk-C3e4t58V.js";import{s as k}from"./chunk-D_TSPZfq.js";import{I as ne}from"./chunk-B4iSJNfF.js";var _={root:"m_18320242","skeleton-fade":"m_299c329c"};const ie={visible:!0,animate:!0},ce=C((e,{width:o,height:r,radius:a,circle:t})=>({root:{"--skeleton-height":x(r),"--skeleton-width":t?x(r):x(o),"--skeleton-radius":t?"1000px":a===void 0?void 0:H(a)}})),D=I((e,o)=>{const r=z("Skeleton",ie,e),{classNames:a,className:t,style:d,styles:u,unstyled:i,vars:n,width:fe,height:he,circle:xe,visible:E,radius:ye,animate:N,mod:F,...M}=r,R=$({name:"Skeleton",classes:_,props:r,className:t,style:d,classNames:a,styles:u,unstyled:i,vars:n,varsResolver:ce});return s.jsx(T,{ref:o,...R("root"),mod:[{visible:E,animate:N},F],...M})});D.classes=_;D.displayName="@mantine/core/Skeleton";const le=({regularPrice:e,promocodePrice:o})=>s.jsxs(L,{className:p.wrapper,children:[s.jsx(q,{className:p.title,order:2,children:"Полный отчет по вашему типу личности"}),s.jsx(D,{className:p.skeleton,hidden:!!e,radius:"sm"}),s.jsxs(A,{gap:"lg",children:[s.jsxs(c,{hidden:!e,className:p.price,td:o?"line-through":"",c:o?"dark.0":"dark.7",children:[e," ",s.jsx(c,{className:p.price,span:!0,ff:"system-ui",children:"₽"})]}),s.jsxs(c,{hidden:!o,className:p.price,c:"violet.8",children:[o," ",s.jsx(c,{className:p.price,span:!0,ff:"system-ui",children:"₽"})]})]})]});function de(e){var o,r;G.unit(e)?o=e:{source:o,reset:r}=e;var a=y(!0,{name:"$canTrigger",sid:"ys2jl0"}),t=l({and:[{source:o,filter:a}],or:{name:"trigger",sid:"e3xto3"}});return a.on(t,()=>!1),r&&a.reset(r),t}const pe=e=>{e.target.value=String(e.target.value).toUpperCase()};function me(e){return te(e)&&"data"in e&&"message"in e}const f=U({and:[],or:{name:"BuyReportGate",sid:"z1ft12"}}),B=j({name:"applyPromocodeClicked",sid:"1fvequ"}),v=y("",{name:"$promocodeErrorMessage",sid:"etihtx"}).on(B,()=>""),h=y(!1,{name:"$showSuccessPromoMessage",sid:"-z69dau"}),w=j({},{name:"reportPurchased",sid:"qsj6tu"});h.reset(f.close);v.reset(f.close);l({and:[{clock:f.close,target:m.reset}],or:{sid:"-9rqp80"}});const S=Q(async e=>{window.open(e,"_self")},{name:"openTransactionPaywallFx",sid:"-dphebw"});l({and:[{clock:B,target:m.start}],or:{sid:"-9b8vf6"}});l({and:[{clock:m.finished.failure,fn:({error:e})=>me(e)?e.data.message:"",target:v}],or:{sid:"-8wy7zs"}});l({and:[{clock:m.finished.failure,fn:()=>!1,target:h}],or:{sid:"-8tngfm"}});l({and:[{clock:m.finished.success,fn:()=>!0,target:h}],or:{sid:"-8et0ev"}});l({and:[{clock:w,target:b.start}],or:{sid:"-7zyke4"}});l({and:[{source:V({sid:"cczs9w",fn:()=>de(b.finished.success),name:"source",method:"once"}),fn:({result:e})=>e.confirmation_url,target:S}],or:{sid:"-7x7lfb"}});const ue=()=>{const{routeParams:{surveyId:e,type:o}}=P(),r=g(w),a=W({mode:"controlled",initialValues:{email:"",mbti_type:e?"":o,promo_code:"",survey_result:e??""},validate:{email:i=>/^\S+@\S+$/.test(i)?null:"Неправильный email"}}),t={radius:"xs",name:"email",withAsterisk:!0,key:a.key("email"),label:"Электронная почта",placeholder:"name@mail.ru",...a.getInputProps("email")},d={radius:"xs",name:"promo_code",key:a.key("promo_code"),placeholder:"Введите промокод",...a.getInputProps("promo_code")},u=a.onSubmit(i=>{const n={...i};i.mbti_type||(n.mbti_type=o),e&&delete n.mbti_type,e||delete n.survey_result,n.promo_code||delete n.promo_code,r(n)});return{form:a,onSubmit:u,emailProps:t,promocodeProps:d}},ge=()=>{Z(f);const{pending:e}=g(m),{onSubmit:o,promocodeProps:r,emailProps:a,form:t}=ue(),{applyPromoHandler:d,promocodeError:u,showSuccessMessage:i,isLoading:n}=g({applyPromoHandler:B,promocodeError:v,showSuccessMessage:h,isLoading:S.pending});return s.jsxs(oe,{onSubmit:o,children:[s.jsx(J,{...a}),s.jsxs(K,{bg:"gray.0",radius:"xs",p:"md",px:"sm",children:[s.jsx(c,{className:k.promocodeLabel,children:"У меня есть промокод"}),s.jsxs(O,{className:k.promocodeWrapper,children:[s.jsx(X,{...r,disabled:e||n,error:u,onInput:pe,"data-success":i,description:i?"Промокод применен":"",inputWrapperOrder:["label","input","description","error"]}),s.jsx(Y,{fullWidth:!0,c:"dark.7",radius:"xs",color:"dark.7",variant:"outline",disabled:e||n,loading:e||n,onClick:()=>d(t.values.promo_code.toUpperCase()),children:"Применить"})]})]}),s.jsx(ee,{disabled:e||n,radius:"xs",size:"md",type:"submit",children:"Перейти к оплате"}),s.jsxs(c,{fz:12,ta:"center",mb:12,children:["Нажимая на кнопку, вы подтверждаете свое согласие на сбор, хранение и использование ваших персональных данных согласно"," ",s.jsx(c,{fz:12,c:"blue.7",component:"a",href:"https://storage.yandexcloud.net/cognitive-lab-public/%D0%9F%D0%BE%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B0%20%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B4%D0%B5%D0%BD%D1%86%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D1%81%D1%82%D0%B8.pdf",children:"Политике конфиденциальности"})," ","и принимаете условия"," ",s.jsx(c,{fz:12,c:"blue.7",component:"a",href:"https://storage.yandexcloud.net/cognitive-lab-public/%D0%94%D0%BE%D0%B3%D0%BE%D0%B2%D0%BE%D1%80%20%D0%BE%D1%84%D0%B5%D1%80%D1%82%D1%8B.pdf",children:"Публичной оферты"})]})]})},Se=()=>{const{data:e,pending:o}=g(se),{data:r}=g(m),{routeParams:{surveyId:a}}=P();if(!e&&o)return s.jsx(re,{});if(!e)return null;const t=a?e.regular_price:e.skip_survey_price,d=a?r==null?void 0:r.regular_price.final:r==null?void 0:r.skip_survey_price.final;return s.jsxs(ne,{image:"/images/paywall-man_large.webp",children:[s.jsx(le,{regularPrice:t,promocodePrice:d}),s.jsx(ge,{}),s.jsx(ae,{})]})};export{Se as P};
