import{N as I,Q as $,a4 as T,j as s,B as z,a8 as C,av as L,ag as y,az as A,n as x,t as l,S as H,T as q,aq as G,h as c,v as Q,Y as U,p as k,aA as m,aB as P,w as V,u as b,e as f,$ as W,a1 as Y,a0 as J,P as K,F as O,aC as X,m as Z,M as ee,ay as se}from"./chunk-h5mJagRN.js";import"./chunk-DBfzkylw.js";import{P as re}from"./chunk-DAIX98Ez.js";import{s as p}from"./chunk-C1UfUYGV.js";import{N as ae}from"./chunk-BUIxMfAi.js";import{F as oe}from"./chunk-DJ9kDput.js";import{s as j}from"./chunk-D_TSPZfq.js";import{I as te}from"./chunk-Oiydxf3W.js";var _={root:"m_18320242","skeleton-fade":"m_299c329c"};const ne={visible:!0,animate:!0},ie=C((e,{width:r,height:a,radius:o,circle:t})=>({root:{"--skeleton-height":y(a),"--skeleton-width":t?y(a):y(r),"--skeleton-radius":t?"1000px":o===void 0?void 0:L(o)}})),D=I((e,r)=>{const a=$("Skeleton",ne,e),{classNames:o,className:t,style:d,styles:u,unstyled:i,vars:n,width:ge,height:he,circle:ye,visible:N,radius:xe,animate:E,mod:M,...R}=a,F=T({name:"Skeleton",classes:_,props:a,className:t,style:d,classNames:o,styles:u,unstyled:i,vars:n,varsResolver:ie});return s.jsx(z,{ref:r,...F("root"),mod:[{visible:N,animate:E},M],...R})});D.classes=_;D.displayName="@mantine/core/Skeleton";function ce(e){var r,a;A.unit(e)?r=e:{source:r,reset:a}=e;var o=x(!0,{name:"$canTrigger",sid:"ys2jl0"}),t=l({and:[{source:r,filter:o}],or:{name:"trigger",sid:"e3xto3"}});return o.on(t,()=>!1),a&&o.reset(a),t}const le=({regularPrice:e,promocodePrice:r})=>s.jsxs(H,{className:p.wrapper,children:[s.jsx(q,{className:p.title,order:2,children:"Полный отчет по вашему типу личности"}),s.jsx(D,{className:p.skeleton,hidden:!!e,radius:"sm"}),s.jsxs(G,{gap:"lg",children:[s.jsxs(c,{hidden:!e,className:p.price,td:r?"line-through":"",c:r?"dark.0":"dark.7",children:[e," ",s.jsx(c,{className:p.price,span:!0,ff:"system-ui",children:"₽"})]}),s.jsxs(c,{hidden:!r,className:p.price,c:"violet.8",children:[r," ",s.jsx(c,{className:p.price,span:!0,ff:"system-ui",children:"₽"})]})]})]});function de(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}const pe=e=>{e.target.value=String(e.target.value).toUpperCase()};function me(e){return de(e)&&"data"in e&&"message"in e}const g=U({and:[],or:{name:"BuyReportGate",sid:"z1ft12"}}),B=k({name:"applyPromocodeClicked",sid:"1fvequ"}),v=x("",{name:"$promocodeErrorMessage",sid:"etihtx"}).on(B,()=>""),h=x(!1,{name:"$showSuccessPromoMessage",sid:"-y864ig"}),w=k({},{name:"reportPurchased",sid:"rqmfm8"});h.reset(g.close);v.reset(g.close);l({and:[{clock:g.close,target:m.reset}],or:{sid:"-9f3fkp"}});const S=Q(async e=>{window.open(e,"_self")},{name:"openTransactionPaywallFx",sid:"-cre5ji"});l({and:[{clock:B,target:m.start}],or:{sid:"-8yllrv"}});l({and:[{clock:m.finished.failure,fn:({error:e})=>me(e)?e.data.message:"",target:v}],or:{sid:"-8vumt2"}});l({and:[{clock:m.finished.failure,fn:()=>!1,target:h}],or:{sid:"-8h06sb"}});l({and:[{clock:m.finished.success,fn:()=>!0,target:h}],or:{sid:"-8dpf85"}});l({and:[{clock:w,target:P.start}],or:{sid:"-7yuz7e"}});l({and:[{source:V({sid:"db312a",fn:()=>ce(P.finished.success),name:"source",method:"once"}),fn:({result:e})=>e.confirmation_url,target:S}],or:{sid:"-7w408l"}});const ue=()=>{const{routeParams:{surveyId:e,type:r}}=b(),a=f(w),o=W({mode:"controlled",initialValues:{email:"",mbti_type:e?"":r,promo_code:"",survey_result:e??""},validate:{email:i=>/^\S+@\S+$/.test(i)?null:"Неправильный email"}}),t={radius:"xs",name:"email",withAsterisk:!0,key:o.key("email"),label:"Электронная почта",placeholder:"name@mail.ru",...o.getInputProps("email")},d={radius:"xs",name:"promo_code",key:o.key("promo_code"),placeholder:"Введите промокод",...o.getInputProps("promo_code")},u=o.onSubmit(i=>{const n={...i};i.mbti_type||(n.mbti_type=r),e&&delete n.mbti_type,e||delete n.survey_result,n.promo_code||delete n.promo_code,a(n)});return{form:o,onSubmit:u,emailProps:t,promocodeProps:d}},fe=()=>{Y(g);const{pending:e}=f(m),{onSubmit:r,promocodeProps:a,emailProps:o,form:t}=ue(),{applyPromoHandler:d,promocodeError:u,showSuccessMessage:i,isLoading:n}=f({applyPromoHandler:B,promocodeError:v,showSuccessMessage:h,isLoading:S.pending});return s.jsxs(oe,{onSubmit:r,children:[s.jsx(J,{...o}),s.jsxs(K,{bg:"gray.0",radius:"xs",p:"md",px:"sm",children:[s.jsx(c,{className:j.promocodeLabel,children:"У меня есть промокод"}),s.jsxs(O,{className:j.promocodeWrapper,children:[s.jsx(X,{...a,disabled:e||n,error:u,onInput:pe,"data-success":i,description:i?"Промокод применен":"",inputWrapperOrder:["label","input","description","error"]}),s.jsx(Z,{fullWidth:!0,c:"dark.7",radius:"xs",color:"dark.7",variant:"outline",disabled:e||n,loading:e||n,onClick:()=>d(t.values.promo_code.toUpperCase()),children:"Применить"})]})]}),s.jsx(ee,{disabled:e||n,radius:"xs",size:"md",type:"submit",children:"Перейти к оплате"}),s.jsxs(c,{fz:12,ta:"center",mb:12,children:["Нажимая на кнопку, вы подтверждаете свое согласие на сбор, хранение и использование ваших персональных данных согласно"," ",s.jsx(c,{fz:12,c:"blue.7",component:"a",href:"https://storage.yandexcloud.net/cognitive-lab-public/%D0%9F%D0%BE%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B0%20%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B4%D0%B5%D0%BD%D1%86%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D1%81%D1%82%D0%B8.pdf",children:"Политике конфиденциальности"})," ","и принимаете условия"," ",s.jsx(c,{fz:12,c:"blue.7",component:"a",href:"https://storage.yandexcloud.net/cognitive-lab-public/%D0%94%D0%BE%D0%B3%D0%BE%D0%B2%D0%BE%D1%80%20%D0%BE%D1%84%D0%B5%D1%80%D1%82%D1%8B.pdf",children:"Публичной оферты"})]})]})},we=()=>{const{data:e,pending:r}=f(se),{data:a}=f(m),{routeParams:{surveyId:o}}=b();if(!e&&r)return s.jsx(re,{});if(!e)return null;const t=o?e.regular_price:e.skip_survey_price,d=o?a==null?void 0:a.regular_price.final:a==null?void 0:a.skip_survey_price.final;return s.jsxs(te,{image:"/images/paywall-man_large.webp",children:[s.jsx(le,{regularPrice:t,promocodePrice:d}),s.jsx(fe,{}),s.jsx(ae,{})]})};export{we as P};
