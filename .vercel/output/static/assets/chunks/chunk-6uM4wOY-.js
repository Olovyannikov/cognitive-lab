import{a5 as I,a6 as $,ae as T,j as s,B as z,aj as C,ap as L,a8 as x,S as H,T as q,ak as A,h as c,aq as G,p as y,z as l,v as U,X as V,q as v,ar as m,as as P,w as W,u as _,e as f,Z as Q,$ as X,_ as Z,P as J,F as K,at as Y,m as O,M as ee,ao as se}from"./chunk-CSBRXxb8.js";import"./chunk-DVMTm1QA.js";import{P as re}from"./chunk-DInC_Ln7.js";import{s as p}from"./chunk-C1UfUYGV.js";import{N as ae}from"./chunk-HYrYkgvA.js";import{F as oe}from"./chunk-CLW4sEkb.js";import{i as te}from"./chunk-DsWTEMC-.js";import{s as j}from"./chunk-D_TSPZfq.js";import{I as ne}from"./chunk-BjSTQhWy.js";var b={root:"m_18320242","skeleton-fade":"m_299c329c"};const ie={visible:!0,animate:!0},ce=C((e,{width:o,height:r,radius:a,circle:t})=>({root:{"--skeleton-height":x(r),"--skeleton-width":t?x(r):x(o),"--skeleton-radius":t?"1000px":a===void 0?void 0:L(a)}})),D=I((e,o)=>{const r=$("Skeleton",ie,e),{classNames:a,className:t,style:d,styles:u,unstyled:i,vars:n,width:fe,height:ge,circle:he,visible:N,radius:xe,animate:E,mod:M,...R}=r,F=T({name:"Skeleton",classes:b,props:r,className:t,style:d,classNames:a,styles:u,unstyled:i,vars:n,varsResolver:ce});return s.jsx(z,{ref:o,...F("root"),mod:[{visible:N,animate:E},M],...R})});D.classes=b;D.displayName="@mantine/core/Skeleton";const le=e=>{e.target.value=String(e.target.value).toUpperCase()},de=({regularPrice:e,promocodePrice:o})=>s.jsxs(H,{className:p.wrapper,children:[s.jsx(q,{className:p.title,order:2,children:"Полный отчет по вашему типу личности"}),s.jsx(D,{className:p.skeleton,hidden:!!e,radius:"sm"}),s.jsxs(A,{gap:"lg",children:[s.jsxs(c,{hidden:!e,className:p.price,td:o?"line-through":"",c:o?"dark.0":"dark.7",children:[e," ",s.jsx(c,{className:p.price,span:!0,ff:"system-ui",children:"₽"})]}),s.jsxs(c,{hidden:!o,className:p.price,c:"violet.8",children:[o," ",s.jsx(c,{className:p.price,span:!0,ff:"system-ui",children:"₽"})]})]})]});function pe(e){var o,r;G.unit(e)?o=e:{source:o,reset:r}=e;var a=y(!0,{name:"$canTrigger",sid:"ys2jl0"}),t=l({and:[{source:o,filter:a}],or:{name:"trigger",sid:"e3xto3"}});return a.on(t,()=>!1),r&&a.reset(r),t}const g=V({and:[],or:{name:"BuyReportGate",sid:"zihff9"}}),B=v({name:"applyPromocodeClicked",sid:"1wx151"}),k=y("",{name:"$promocodeErrorMessage",sid:"fak484"}).on(B,()=>""),h=y(!1,{name:"$showSuccessPromoMessage",sid:"-yp7qwn"}),w=v({},{name:"reportPurchased",sid:"r9kt81"});h.reset(g.close);k.reset(g.close);l({and:[{clock:g.close,target:m.reset}],or:{sid:"-9fn862"}});const S=U(async e=>{window.open(e,"_self")},{name:"openTransactionPaywallFx",sid:"-d8frxp"});l({and:[{clock:B,target:m.start}],or:{sid:"-9ap2tt"}});l({and:[{clock:m.finished.failure,fn:({error:e})=>te(e)?e.data.message:"",target:k}],or:{sid:"-8wefef"}});l({and:[{clock:m.finished.failure,fn:()=>!1,target:h}],or:{sid:"-8hjzdo"}});l({and:[{clock:m.finished.success,fn:()=>!0,target:h}],or:{sid:"-8e97ti"}});l({and:[{clock:w,target:P.start}],or:{sid:"-7zersr"}});l({and:[{source:W({sid:"cu1eo3",fn:()=>pe(P.finished.success),name:"source",method:"once"}),fn:({result:e})=>e.confirmation_url,target:S}],or:{sid:"-7wnsty"}});const me=()=>{const{routeParams:{surveyId:e,type:o}}=_(),r=f(w),a=Q({mode:"controlled",initialValues:{email:"",mbti_type:e?"":o,promo_code:"",survey_result:e??""},validate:{email:i=>/^\S+@\S+$/.test(i)?null:"Неправильный email"}}),t={radius:"xs",name:"email",withAsterisk:!0,key:a.key("email"),label:"Электронная почта",placeholder:"name@mail.ru",...a.getInputProps("email")},d={radius:"xs",name:"promo_code",key:a.key("promo_code"),placeholder:"Введите промокод",...a.getInputProps("promo_code")},u=a.onSubmit(i=>{const n={...i};i.mbti_type||(n.mbti_type=o),e&&delete n.mbti_type,e||delete n.survey_result,n.promo_code||delete n.promo_code,r(n)});return{form:a,onSubmit:u,emailProps:t,promocodeProps:d}},ue=()=>{X(g);const{pending:e}=f(m),{onSubmit:o,promocodeProps:r,emailProps:a,form:t}=me(),{applyPromoHandler:d,promocodeError:u,showSuccessMessage:i,isLoading:n}=f({applyPromoHandler:B,promocodeError:k,showSuccessMessage:h,isLoading:S.pending});return s.jsxs(oe,{onSubmit:o,children:[s.jsx(Z,{...a}),s.jsxs(J,{bg:"gray.0",radius:"xs",p:"md",px:"sm",children:[s.jsx(c,{className:j.promocodeLabel,children:"У меня есть промокод"}),s.jsxs(K,{className:j.promocodeWrapper,children:[s.jsx(Y,{...r,disabled:e||n,error:u,onInput:le,"data-success":i,description:i?"Промокод применен":"",inputWrapperOrder:["label","input","description","error"]}),s.jsx(O,{fullWidth:!0,c:"dark.7",radius:"xs",color:"dark.7",variant:"outline",disabled:e||n,loading:e||n,onClick:()=>d(t.values.promo_code.toUpperCase()),children:"Применить"})]})]}),s.jsx(ee,{disabled:e||n,radius:"xs",size:"md",type:"submit",children:"Перейти к оплате"}),s.jsxs(c,{fz:12,ta:"center",mb:12,children:["Нажимая на кнопку, вы подтверждаете свое согласие на сбор, хранение и использование ваших персональных данных согласно"," ",s.jsx(c,{fz:12,c:"blue.7",component:"a",href:"https://storage.yandexcloud.net/cognitive-lab-public/%D0%9F%D0%BE%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B0%20%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B4%D0%B5%D0%BD%D1%86%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D1%81%D1%82%D0%B8.pdf",children:"Политике конфиденциальности"})," ","и принимаете условия"," ",s.jsx(c,{fz:12,c:"blue.7",component:"a",href:"https://storage.yandexcloud.net/cognitive-lab-public/%D0%94%D0%BE%D0%B3%D0%BE%D0%B2%D0%BE%D1%80%20%D0%BE%D1%84%D0%B5%D1%80%D1%82%D1%8B.pdf",children:"Публичной оферты"})]})]})},we=()=>{const{data:e,pending:o}=f(se),{data:r}=f(m),{routeParams:{surveyId:a}}=_();if(!e&&o)return s.jsx(re,{});if(!e)return null;const t=a?e.regular_price:e.skip_survey_price,d=a?r==null?void 0:r.regular_price.final:r==null?void 0:r.skip_survey_price.final;return s.jsxs(ne,{image:"/images/paywall-man_large.webp",children:[s.jsx(de,{regularPrice:t,promocodePrice:d}),s.jsx(ue,{}),s.jsx(ae,{})]})};export{we as P};
